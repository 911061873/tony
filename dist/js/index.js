$(document).ready((function(){window.site_url,window.wp_rest;var t=0,e=1,s=null,i="";$(".article-list").css("opacity","1"),$(".cat-real").attr("style","display:inline-block"),new Vue({el:"#grid-cell",data:()=>({m:window.index_m,site_url:window.site_url,exclude_option:window.cate_exclude_option,cate_exclude:window.cate_exclude,exclude_params:"",cates_exclude:window.cates_exclude,cate_exclude_params:"",cate_exclude_option:window.cates_exclude_option,pages:window.index_p,preview_comment_open:window.preview_comment_open,posts:null,posts_id_sticky:"0",cates:null,tages:null,loading:!0,loading_cates:!0,loading_tages:!0,errored:!0,loading_css:"loading-line",comments_html:'<div id="new_comments" style="margin-top:40px"></div>'}),mounted(){"true"==this.cate_exclude&&(this.exclude_params="?exclude="+this.exclude_option),"true"==this.cates_exclude&&(this.cate_exclude_params="&categories_exclude="+this.cate_exclude_option),axios.get(this.site_url+"/wp-json/wp/v2/categories"+this.exclude_params).then((t=>{this.cates=t.data})).then((()=>{this.loading_cates=!1,axios.get(this.site_url+"/wp-json/wp/v2/tags?order=desc&per_page=15").then((t=>{this.tages=t.data})).then((()=>{this.loading_tages=!1}))})),axios.get(this.site_url+"/wp-json/wp/v2/posts?sticky=1&"+this.cate_exclude_params).then((t=>{this.posts=t.data;for(var s=0;s<this.posts.length;++s)this.posts_id_sticky+=","+this.posts[s].id;axios.get(this.site_url+"/wp-json/wp/v2/posts?sticky=0&exclude="+this.posts_id_sticky+"&per_page="+this.pages+"&page="+e+this.cate_exclude_params).then((t=>{this.posts=this.posts.concat(t.data)}))})).catch((t=>{this.errored=!1,alert("文章加载失败，可能是伪静态未配置正确，请参考: https://www.wpdaxue.com/wordpress-rewriterule.html 来配置。加入 QQ 群：454846972 以获得更多支持。")})).then((()=>{this.loading=!1,e++,$(window).scroll((function(){$(window).scrollTop()>=$(".bottom").offset().top-800&&0==t&&($("#scoll_new_list").click(),t++)})),axios.get(this.site_url+"/wp-json/wp/v2/posts?per_page="+this.pages+"&page="+e+this.cate_exclude_params).then((t=>{t.data.length&&0!=t.data.length||(this.loading_css="",$("#view-text").html("-&nbsp;全部文章&nbsp;-"),$(".bottom h5").html('暂无更多文章了 O__O "…').css({background:"#fff",color:"#999"}))})).catch((t=>{this.loading_css="",$("#view-text").html("-&nbsp;所有文章&nbsp;-"),$(".bottom h5").html('暂无更多文章了 O__O "…').css({background:"#fff",color:"#999"})}))}))},methods:{new_page:function(){$("#view-text").html("-&nbsp;加载中&nbsp;-"),axios.get(this.site_url+"/wp-json/wp/v2/posts?sticky=0&exclude="+this.posts_id_sticky+"&per_page="+this.pages+"&page="+e+this.cate_exclude_params).then((s=>{s.data.length&&0!==s.data.length?($("#view-text").html("-&nbsp;文章列表&nbsp;-"),this.posts.push.apply(this.posts,s.data),t=0,e++):(this.loading_css="",$("#view-text").html("-&nbsp;全部文章&nbsp;-"),$(".bottom h5").html('暂无更多文章了 O__O "…').css({background:"#fff",color:"#999"}))})).catch((t=>{this.loading_css="",$("#view-text").html("-&nbsp;所有文章&nbsp;-"),$(".bottom h5").html('暂无更多文章了 O__O "…').css({background:"#fff",color:"#999"})}))},preview:function(t){var e=$(".article-list-item .preview-p");if(e.length){var a=e.parent(".article-list-item");if(a.find(".list-show-btn").html("全文速览"),a.find(".article-list-content").html(i).removeClass("preview-p"),i="",this.comments_html='<div id="new_comments" style="margin-top:40px"></div>',t===s)return}i=$("#"+t).html(),$("#"+t).html('<div uk-spinner></div><h7 class="loading-text">加载中...</h7>'),axios.get(this.site_url+"/wp-json/wp/v2/posts/"+t).then((e=>{0!==e.data.length?axios.get(this.site_url+"/wp-json/wp/v2/comments?post="+t).then((i=>{if("open"==e.data.comment_status&&this.preview_comment_open){for(var a=0;a<i.data.length;++a)this.comments_html+='<div class="quick-div"><div><img class="quick-img" src="'+i.data[a].author_avatar_urls[48]+'"></div><div><p class="quick-name">'+i.data[a].author_name+'<em class="quick-date">'+i.data[a].date+"</em></p>"+i.data[a].content.rendered+"</div></div>";this.comments_html+='<div class="quick-div" style="margin-top: 15px;padding-bottom: 0px;"><div style="flex:1;border-right: 1px solid #eee;"><input type="text" placeholder="昵称" id="comment_form_name" class="quick-form"></div><div style="flex:1;margin-left: 10px;"><input type="email" placeholder="邮箱" id="comment_form_email" class="quick-form"></div></div><div class="quick-div" style="padding: 4px;"><textarea placeholder="说点什么..." id="comment_form_content" class="quick-form-textarea"></textarea></div><button class="quick-btn" onclick="send_comment('+t+')">发送评论</button>'}if($("#btn"+t).html("收起速览"),this.m){var o=e.data.md_content;o=md.render(o)}else o=e.data.content.rendered;$("#"+t).addClass("preview-p").html(o+this.comments_html),s=t,document.querySelectorAll("pre code").forEach((t=>{hljs.highlightBlock(t)}))})):$("#"+t).html("Nothing Here")}))}}})}));